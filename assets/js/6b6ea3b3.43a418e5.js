"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8184],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,b=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return n?r.createElement(b,o(o({ref:t},s),{},{components:n})):r.createElement(b,o({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9858:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var r=n(3117),a=n(102),i=(n(7294),n(3905)),o=["components"],l={id:"dexie",title:"dexie"},c=void 0,p={unversionedId:"FE/npm/pkgs/dexie",id:"FE/npm/pkgs/dexie",title:"dexie",description:"\u5b66\u4e60\u6587\u6863",source:"@site/docs/FE/npm/pkgs/dexie.md",sourceDirName:"FE/npm/pkgs",slug:"/FE/npm/pkgs/dexie",permalink:"/docs/FE/npm/pkgs/dexie",draft:!1,tags:[],version:"current",lastUpdatedAt:1685726734,formattedLastUpdatedAt:"Jun 2, 2023",frontMatter:{id:"dexie",title:"dexie"},sidebar:"tutorialSidebar",previous:{title:"date-fns",permalink:"/docs/FE/npm/pkgs/date-fns"},next:{title:"gh-pages",permalink:"/docs/FE/npm/pkgs/gh-pages"}},s={},d=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:4},{value:"Import dexie",id:"import-dexie",level:4},{value:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784",id:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784",level:4},{value:"\u521b\u5efa\u6570\u636e\u5e93",id:"\u521b\u5efa\u6570\u636e\u5e93",level:4},{value:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1",id:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1",level:4},{value:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316",id:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316",level:4}],u={toc:d};function m(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/dexie"},"https://www.npmjs.com/package/dexie")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://dexie.org/"},"\u5b66\u4e60\u6587\u6863")),(0,i.kt)("h4",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install dexie --save\n### \u5982\u8981\u6dfb\u52a0\u76d1\u6d4b\u6570\u636e\u53d8\u52a8\u529f\u80fd\uff0c\u9700\u8981\u5b89\u88c5dexie-observable\nnom install dexie-observable --save\n")),(0,i.kt)("h4",{id:"import-dexie"},"Import dexie"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'import Dexie from "dexie";\n')),(0,i.kt)("h4",{id:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784"},"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'/** \u6570\u636e\u5e93\u4fe1\u606f\n * @param { string } name \u540d\u79f0\n * @param { number } version \u7248\u672c\u53f7\n * @param { string } tableName \u8868\u540d\u79f0\n */\nconst dbInfo = {\n  name: "bss-product",\n  version: 1007,\n  tableName: "calculator"\n};\n\nexport class IndexedDB extends Dexie {\n  constructor() {\n    // \u6570\u636e\u5e93\u540d\u79f0\n    super(dbInfo.name);\n    this.version(dbInfo.version).stores({\n      calculator: "id, createTime, updateTime, productLine"\n    });\n    this.calculator = this.table(dbInfo.tableName);\n  }\n\n  calculator: Dexie.Table<ProductInfo, string>; // number = type of the primkey\n}\n')),(0,i.kt)("h4",{id:"\u521b\u5efa\u6570\u636e\u5e93"},"\u521b\u5efa\u6570\u636e\u5e93"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'import { IndexedDB } from "./indexDB";\n\nprivate db = new IndexedDB();\n')),(0,i.kt)("h4",{id:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1"},"\u6570\u636e\u64cd\u4f5c\u670d\u52a1"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'## \u83b7\u53d6\u6240\u6709\u6570\u636e\nasync getProducts() {\n    // getAllData(): Observable<any> {\n    await this.db.open().catch(error => {\n      this.delDB();\n      this.getProducts();\n      return;\n    });\n\n    let table = [];\n    await this.db.calculator\n      .orderBy("updateTime")\n      .reverse()\n      .each(item => (table = [...table, item]));\n    return table;\n  }\n## \u63d2\u5165\u6570\u636e\n  insert(table: ProductInfo) {\n    this.db.calculator.put(table);\n  }\n## \u5220\u9664\u6307\u5b9aID\u6570\u636e\u6570\u636e\n  delete(id: string) {\n    this.db.calculator\n      .where("id")\n      .equals(id)\n      .delete();\n  }\n## \u83b7\u53d6\u6307\u5b9aID\u6570\u636e\n  async getProduct(id) {\n    return await this.db.calculator.get(id);\n  }\n## \u7f16\u8f91\u6307\u5b9aID\u6570\u636e\n  updateData(table) {\n    this.db.calculator\n      .update(table.id, {\n        productLine: table.productLine,\n        chargeType: table.chargeType,\n        duration: table.duration,\n        durationUnit: table.durationUnit,\n        price: table.price,\n        productPrice: table.productPrice\n      })\n      .catch(err => {\n        console.error("update data failed: ", err);\n      });\n  }\n')),(0,i.kt)("h4",{id:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316"},"\u76d1\u6d4b\u6570\u636e\u53d8\u5316"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'## \u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u65f6\uff0c\u5f15\u5165dexie-observable\nimport "dexie-observable";\n\n## \u521b\u5efa\u670d\u52a1\n  catchChange = new Observable(observer => {\n    this.db.on("changes", () => {\n      observer.next();\n    });\n  });\n## \u8c03\u7528\u670d\u52a1\n  private productsChange() {\n    this.indexedDB.catchChange.subscribe(() => {\n      this.setProducts();\n    });\n  }\n\n')))}m.isMDXComponent=!0}}]);