"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8184],{9808:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var a=t(5893),r=t(1151);const i={id:"dexie",title:"dexie"},s=void 0,d={id:"FE/npm/pkgs/dexie",title:"dexie",description:"https://www.npmjs.com/package/dexie",source:"@site/docs/FE/npm/pkgs/dexie.md",sourceDirName:"FE/npm/pkgs",slug:"/FE/npm/pkgs/dexie",permalink:"/docs/FE/npm/pkgs/dexie",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1710142821,formattedLastUpdatedAt:"Mar 11, 2024",frontMatter:{id:"dexie",title:"dexie"},sidebar:"tutorialSidebar",previous:{title:"date-fns",permalink:"/docs/FE/npm/pkgs/date-fns"},next:{title:"gh-pages",permalink:"/docs/FE/npm/pkgs/gh-pages"}},c={},l=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:4},{value:"Import dexie",id:"import-dexie",level:4},{value:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784",id:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784",level:4},{value:"\u521b\u5efa\u6570\u636e\u5e93",id:"\u521b\u5efa\u6570\u636e\u5e93",level:4},{value:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1",id:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1",level:4},{value:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316",id:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316",level:4}];function o(e){const n={a:"a",code:"code",h4:"h4",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.npmjs.com/package/dexie",children:"https://www.npmjs.com/package/dexie"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://dexie.org/",children:"\u5b66\u4e60\u6587\u6863"})}),"\n",(0,a.jsx)(n.h4,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"npm install dexie --save\n### \u5982\u8981\u6dfb\u52a0\u76d1\u6d4b\u6570\u636e\u53d8\u52a8\u529f\u80fd\uff0c\u9700\u8981\u5b89\u88c5dexie-observable\nnom install dexie-observable --save\n"})}),"\n",(0,a.jsx)(n.h4,{id:"import-dexie",children:"Import dexie"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'import Dexie from "dexie";\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784",children:"\u5b9a\u4e49\u6570\u636e\u7ed3\u6784"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'/** \u6570\u636e\u5e93\u4fe1\u606f\n * @param { string } name \u540d\u79f0\n * @param { number } version \u7248\u672c\u53f7\n * @param { string } tableName \u8868\u540d\u79f0\n */\nconst dbInfo = {\n  name: "bss-product",\n  version: 1007,\n  tableName: "calculator"\n};\n\nexport class IndexedDB extends Dexie {\n  constructor() {\n    // \u6570\u636e\u5e93\u540d\u79f0\n    super(dbInfo.name);\n    this.version(dbInfo.version).stores({\n      calculator: "id, createTime, updateTime, productLine"\n    });\n    this.calculator = this.table(dbInfo.tableName);\n  }\n\n  calculator: Dexie.Table<ProductInfo, string>; // number = type of the primkey\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u521b\u5efa\u6570\u636e\u5e93",children:"\u521b\u5efa\u6570\u636e\u5e93"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import { IndexedDB } from "./indexDB";\n\nprivate db = new IndexedDB();\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1",children:"\u6570\u636e\u64cd\u4f5c\u670d\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'## \u83b7\u53d6\u6240\u6709\u6570\u636e\nasync getProducts() {\n    // getAllData(): Observable<any> {\n    await this.db.open().catch(error => {\n      this.delDB();\n      this.getProducts();\n      return;\n    });\n\n    let table = [];\n    await this.db.calculator\n      .orderBy("updateTime")\n      .reverse()\n      .each(item => (table = [...table, item]));\n    return table;\n  }\n## \u63d2\u5165\u6570\u636e\n  insert(table: ProductInfo) {\n    this.db.calculator.put(table);\n  }\n## \u5220\u9664\u6307\u5b9aID\u6570\u636e\u6570\u636e\n  delete(id: string) {\n    this.db.calculator\n      .where("id")\n      .equals(id)\n      .delete();\n  }\n## \u83b7\u53d6\u6307\u5b9aID\u6570\u636e\n  async getProduct(id) {\n    return await this.db.calculator.get(id);\n  }\n## \u7f16\u8f91\u6307\u5b9aID\u6570\u636e\n  updateData(table) {\n    this.db.calculator\n      .update(table.id, {\n        productLine: table.productLine,\n        chargeType: table.chargeType,\n        duration: table.duration,\n        durationUnit: table.durationUnit,\n        price: table.price,\n        productPrice: table.productPrice\n      })\n      .catch(err => {\n        console.error("update data failed: ", err);\n      });\n  }\n'})}),"\n",(0,a.jsx)(n.h4,{id:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316",children:"\u76d1\u6d4b\u6570\u636e\u53d8\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'## \u6570\u636e\u7ed3\u6784\u5b9a\u4e49\u65f6\uff0c\u5f15\u5165dexie-observable\nimport "dexie-observable";\n\n## \u521b\u5efa\u670d\u52a1\n  catchChange = new Observable(observer => {\n    this.db.on("changes", () => {\n      observer.next();\n    });\n  });\n## \u8c03\u7528\u670d\u52a1\n  private productsChange() {\n    this.indexedDB.catchChange.subscribe(() => {\n      this.setProducts();\n    });\n  }\n\n'})})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>d,a:()=>s});var a=t(7294);const r={},i=a.createContext(r);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);